#!/usr/bin/env node
const Base = require('../src')

const argv = require('yargs')
  .option('bucket', {
    type: 'string',
  })
  .option('region', {
    type: 'string',
    default: 'us-east-1'
  })
  .option('accessKeyId', {
    type: 'string',
    default: process.env.AWS_ACCESS_KEY_ID
  })
  .option('secretAccessKey', {
    type: 'string',
    default: process.env.AWS_SECRET_ACCESS_KEY
  })
  .command('$0', 'update bucket policy', () => {}, async argv => {
    const base = new Base(argv)
    try {
      await base.update()
      process.exit(0)
    } catch (err) {
      process.exit(1)
    }
  })
  .command('remove', 'remove bucket policy statement generated by s3-policy', () => {}, async argv => {
    const base = new Base(argv)
    try {
      await base.remove()
      process.exit = 0
    } catch (err) {
      process.exit = 1
    }
  })
  .argv

